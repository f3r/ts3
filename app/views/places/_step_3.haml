.panel-wrapper
  %h2.title Photos
  .clearfix

  .upload_wrapper
    %input{:type => 'file', :name => 'photo_uploader', :class => 'photo_uploader', :value => 'Select files', :id => "photo_uploader" }
    
  .clearfix

  %h3 Photos
  %p
    You can sort your photos by drag and drop
  .row
    .span12
      %ul.media-grid.gallery#photos_list

.arrows.clearfix
  .coda-nav-left
    %a.btn.primary{:href => "#"} &laquo; Previous Step
  .coda-nav-right
    %a.btn.primary{:href => "#"} Next Step &raquo;

:javascript
  $(document).ready(function(){

    function refreshPhotoList() {
      $.ajax( { 
        url : "/places/#{@place.id}/upload_photo", 
        context : $('#photos_list'),
        success : function(data) {
          $(this).html(data);
        }
      });
    }

    var uploadify_script_data = {};
    var csrf_token = $('meta[name=csrf-token]').attr('content');
    var csrf_param = $('meta[name=csrf-param]').attr('content');

    $('#photo_uploader').uploadify({
      'uploader'        : '/javascripts/uploadify/uploadify.swf',
      'script'          : "/places/#{@place.id}/upload_photo",
      'cancelImg'       : '/images/close.png',
      'buttonImg'       : '/images/browse-button.png',
      'auto'            : true,
      'multi'           : true,
      'fileDataName'    : 'file',
      'fileDesc'        : 'Photos',
      'buttonText'      : 'Browse',
      'width'           : 230,
      'height'          : 50,
      'wmode'           : 'transparent',
      'fileExt'         : '*.jpg;*.png',
      'scriptData'      : { 'photo_album_id' : #{@place.id}, '_method' : 'post', 'csrf_token' : encodeURI(csrf_param), '#{Rails.application.config.session_options[:key]}' : '#{cookies[Rails.application.config.session_options[:key]]}', 'token' : '#{current_token}' , 'format': 'json' },
      'onSelect'        : function(event, data) {  },
      'onAllComplete'      : function(event, data) { refreshPhotoList(); }
    });

  });
