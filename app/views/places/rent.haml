%ul.breadcrumb
  %li
    = link_to @place['title'], place_path(@place["id"])
    %span.divider= "/"
  %li.active
    =t(:rent)


.row
  .span16

    = form_tag(availability_place_path, :method => :post) do

      .panel
        .panel-wrapper
          %h2.title
            = t(:place_details)

      .row
        .span3
          .thumb.data-block
            = image_tag(@place['photos'].blank? ? "http://placehold.it/150x90" : @place['photos'][0]['photo']['small'])
        .span3
          %h3= @place.title
          = "#{@place.city_name}, #{@place.country_name}"
        .span3
          .type 
            = @place.place_type 
          .micro
            - if !@place['size_sqf'].nil? or !@place['size_sqm'].nil?
              = get_current_size_unit == "sqf" ? @place['size_sqf'].round(2) : @place['size_sqm'].round(2)
              =raw get_pref_size_unit
        .span3
          .price
            - if !@place['price_per_night'].nil?
              .figure= "#{get_pref_currency}#{@place['price_per_night']} Per night"
            - else
              &nbsp;

      .row
        .span3
          .check_in
            check-in
            = @place['check_in_after']
        .span3
          .check_out
            check-out
            = @place['check_out_before']
        .span3
          .cancellation_policy
            Cancellation Policy
            = @place['cancellation_policy']

      .row
        .span3
          .guests
            Guests
            = @place['max_guests']
        .span3
          .bedrooms
            Bedrooms
            = @place['bedrooms']
        .span3
          .house_rules
            House Rules
            = @place['house_rules']

      .panel
        .panel-wrapper
          %h2.title
            = t(:stay_details)


      %fieldset
        .clearfix
        <p id="date3"></p>
        <p><a href="#" id="clearSelection">Clear selection</a></p>
        .clearfix
          .input.required
            = label_tag :arriving, t(:arriving)
            = hidden_field_tag :check_in
            .check_in_preview
          .input.required
            = label_tag :check_out, t(:departing)
            = hidden_field_tag :check_out
            .check_out_preview
          .input
            = label_tag :duration, t(:duration)
            .duration
              0 days
      .panel
        .panel-wrapper
          %h2.title
            = t(:contact_information)
      %fieldset
        .clearfix
          .input.required
            = label_tag :mobile_phone_number, t(:mobile_phone_number)
            = text_field_tag :phone_mobile, current_user.phone_mobile
          .input.required
            = label_tag :passport_number, t(:passport_number)
            = text_field_tag :passport_number, current_user.passport_number

        .clearfix
          = t(:read_agreement)
        %button.btn
          = t(:continue)

%link{:rel => "stylesheet", :href => "/javascripts/datepicker/css/datepicker.css", :type => "text/css"}
%script{:src => '/javascripts/datepicker/js/datepicker.js', :type => 'text/javascript'}
%script{:src => '/javascripts/datepicker/js/eye.js', :type => 'text/javascript'}
%script{:src => '/javascripts/datepicker/js/utils.js', :type => 'text/javascript'}


:javascript

  function daydiff(first, second) {
    return (second-first)/(1000*60*60*24)
  }
  
  function update_duration(start,end) {
    diff = daydiff(start, end);
    $('div.duration').html(Math.round(diff));
  }
  
  (function($){
  	var initLayout = function() {

      var today = new Date();
      var dd = today.getDate();
      var mm = today.getMonth()+1; //January is 0!

      var yyyy = today.getFullYear();
      if(dd<10){dd='0'+dd} if(mm<10){mm='0'+mm} var today = yyyy+'/'+mm+'/'+dd;

  		$('#clearSelection').bind('click', function(){
  			$('#date3').DatePickerClear();
  			return false;
  		});
  		$('#date3').DatePicker({
  			flat: true,
        // date: ['2011-12-01','2011-12-23'],
        date: [today,today],
  			current: today,
  			calendars: 2,
  			mode: 'range',
  			starts: 1,
      	onChange: function(formated, dates){
      	  $('#check_in').val(formated[0]);
      	  $('#check_out').val(formated[1]);
      	  $('.check_in_preview').html(formated[0]);
      	  $('.check_out_preview').html(formated[1]);
      	  update_duration(dates[0],dates[1])
      	}
  		});
  	};
  	EYE.register(initLayout, 'init');
  })(jQuery)